
#!/bin/sh
# Cross-platform pre-commit hook (POSIX sh)
# Try pwsh (PowerShell Core), then powershell/powershell.exe (Windows PowerShell)
# Run the update_last_modified.ps1 script if possible. Do not block commit on failure.

ROOT_DIR=$(git rev-parse --show-toplevel 2>/dev/null || echo "")
if [ -z "$ROOT_DIR" ]; then
    exit 0
fi

SCRIPT="$ROOT_DIR/scripts/update_last_modified.ps1"
if [ ! -f "$SCRIPT" ]; then
    exit 0
fi

cmd=""
if command -v pwsh >/dev/null 2>&1; then
    cmd="pwsh -NoProfile -ExecutionPolicy Bypass -File '$SCRIPT'"
elif command -v powershell >/dev/null 2>&1; then
    cmd="powershell -NoProfile -ExecutionPolicy Bypass -File '$SCRIPT'"
elif command -v powershell.exe >/dev/null 2>&1; then
    cmd="powershell.exe -NoProfile -ExecutionPolicy Bypass -File '$SCRIPT'"
fi

if [ -n "$cmd" ]; then
    # shellcheck disable=SC2086
    eval $cmd || true
fi

exit 0
